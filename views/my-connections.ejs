<!DOCTYPE html>
<html lang="en">
<head>
    <%- include('partials/head') %>
</head>
<body>
    <!-- Sidebar -->
    <%- include('partials/sidebar') %>

    <!-- Main Content -->
    <main class="main-content">
        <div class="page-content">
            <!-- Page Header -->
            <div class="page-header">
                <div>
                    <h1 class="page-title">My Connections</h1>
                    <p class="page-description">Manage your integration connections</p>
                </div>
            </div>

            <!-- User Selection -->
            <div class="filter-section">
                <div class="user-selector">
                    <label for="userSelect">Select User:</label>
                    <select id="userSelect" onchange="handleUserChange()">
                        <option value="">Choose a user...</option>
                    </select>
                </div>
            </div>

            <!-- No User Selected State -->
            <div id="noUserState" class="empty-state-container">
                <div class="empty-state">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" width="64" height="64">
                        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                        <circle cx="9" cy="7" r="4"/>
                        <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
                        <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                    </svg>
                    <h3>Select a User</h3>
                    <p>Choose a user to view their connections</p>
                </div>
            </div>

            <!-- Loading State -->
            <div id="loadingState" class="loading-state" style="display: none;">
                <div class="spinner"></div>
                <p>Loading connections...</p>
            </div>

            <!-- Connections Container -->
            <div id="connectionsContainer" style="display: none;">
                <!-- Stats Cards -->
                <div class="stats-grid" id="statsGrid">
                    <div class="stat-card">
                        <div class="stat-icon active">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/>
                            </svg>
                        </div>
                        <div class="stat-content">
                            <div class="stat-value" id="activeCount">0</div>
                            <div class="stat-label">Active Connections</div>
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon total">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/>
                                <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/>
                            </svg>
                        </div>
                        <div class="stat-content">
                            <div class="stat-value" id="totalCount">0</div>
                            <div class="stat-label">Total Connections</div>
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon recent">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <circle cx="12" cy="12" r="10"/>
                                <polyline points="12 6 12 12 16 14"/>
                            </svg>
                        </div>
                        <div class="stat-content">
                            <div class="stat-value" id="recentCount">0</div>
                            <div class="stat-label">Added This Week</div>
                        </div>
                    </div>
                </div>

                <!-- Filter Tabs -->
                <div class="filter-tabs">
                    <button class="filter-tab active" data-status="all" onclick="filterByStatus('all')">
                        All Connections
                    </button>
                    <button class="filter-tab" data-status="active" onclick="filterByStatus('active')">
                        Active
                    </button>
                    <button class="filter-tab" data-status="inactive" onclick="filterByStatus('inactive')">
                        Inactive
                    </button>
                </div>

                <!-- Connections Grid -->
                <div id="connectionsList" class="connections-grid">
                    <!-- Connections will be populated here -->
                </div>

                <!-- Empty State -->
                <div id="emptyState" class="empty-state" style="display: none;">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" width="64" height="64">
                        <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/>
                        <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/>
                    </svg>
                    <h3>No Connections</h3>
                    <p>This user hasn't connected any integrations yet</p>
                    <button class="btn btn-primary" onclick="goToIntegrations()">
                        Browse Integrations
                    </button>
                </div>
            </div>
        </div>
    </main>

    <!-- Connection Details Modal -->
    <div id="connectionModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">Connection Details</h2>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body" id="modalBody">
                <!-- Connection details will be populated here -->
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal()">Close</button>
                <button class="btn btn-primary" id="testConnectionBtn" onclick="testConnection()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" width="18" height="18">
                        <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                        <polyline points="22 4 12 14.01 9 11.01"/>
                    </svg>
                    Test Connection
                </button>
                <button class="btn btn-danger" id="deleteConnectionBtn" onclick="deleteConnection()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" width="18" height="18">
                        <polyline points="3 6 5 6 21 6"/>
                        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                    </svg>
                    Delete
                </button>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast"></div>

    <script src="/js/my-connections.js"></script>
</body>
</html>
